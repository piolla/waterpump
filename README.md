# waterpump
# IoT 데이터 리뉴얼로 실시간 모니터링 시스템 구축
# (단순한 시계열에서 지능형 분석 플랫폼까지)

- 제조업 현장에서 IoT 센서로부터 수집되는 온도 데이터. 언뜻 보면 단순해 보이는 이 데이터가 과연 우리에게 얼마나 많은 인사이트를 제공할 수 있을까요?
- 기존의 원시 IoT 데이터는 마치 조각난 퍼즐 같았습니다. 시간(timestamp)과 온도(value)라는 두 개의 컬럼만으로는 진정한 의미를 파악하기 어려웠죠. 
- 하지만 데이터 리뉴얼이라는 혁신적 접근을 통해, 우리는 이 단순한 데이터에 생명을 불어넣을 수 있었습니다.
- 실제 워터펌프 온도 모니터링 프로젝트를 통해, IoT 데이터를 어떻게 지능형 분석 시스템으로 발전시켰는지 그 여정을 공유하고자 합니다.
- 본 사례는 온도 데이터 뿐만 아니라 제조 설비 ioT 데이터로 부터 간단한 Label을 부여하여 보다 쉽고 빠르게 확장할 수 있을 것 입니다.  

# 1. 기존 데이터의 한계: 숨겨진 패턴을 찾아서
``` csv
# 원시 데이터의 모습
timestamp,value 
2024-01-01 10:00:00,45.2 
2024-01-01 10:10:00,46.1 
2024-01-01 10:20:00,47.3 ...
```

처음 마주한 워터펌프 온도 데이터는 이처럼 단순했습니다. 시간과 온도 값만 있는 평범한 시계열 데이터였죠. 하지만 제조업 현장에서는 이런 질문들이 끊임없이 제기되었습니다:

"지금 온도가 정상인지 어떻게 알 수 있나요?"
"언제쯤 정비를 해야 할까요?"
"이상 징후를 미리 감지할 수 있나요?"
"과거 데이터와 비교해서 현재 상태는 어떤가요?"
단순한 온도 수치만으로는 이런 질문에 답하기 어려웠습니다. 데이터는 있지만 인사이트가 없는 상황이었죠.


# 2. 데이터에 의미를 부여하다
혁신적 아이디어: 구간별 특성 분석
우리가 도입한 Window 100 라벨링 기법은 게임 체인저였습니다. 100개의 연속된 온도 측정값을 하나의 배치로 묶어, 각 배치의 특성을 분석하고 라벨을 부여하는 방식이었죠.

왜 100개인가?
- 통계적 유의성: 100개 샘플이면 신뢰할 만한 통계 분석 가능
- 실시간성: 10분 간격 측정 시 약 16시간의 운영 데이터
- 패턴 인식: 충분한 데이터로 온도 변화 패턴 파악 가능
- 운영 효율성: 너무 크지도 작지도 않은 최적 크기

## 2-1) 라벨 생성 메커니즘
- 각 Window 100 배치에 대해 다음과 같은 다차원 분석을 수행했습니다:

## 2-2) 온도 범주 분류
```python

if mean_temp < 40:     
	temp_category = "저온" # 부하가 낮거나 초기 가동 
elif mean_temp < 70:     
	temp_category = "정상" # 최적 운영 범위 
elif mean_temp < 85:     
	temp_category = "고온" # 주의 관찰 필요
else:
  temp_category = "과열"     # 즉시 점검 필요
```

## 2-3) 안정성 평가
```python
if std_temp < 2:     
	stability = "안정"          # 일정한 운영 상태 
elif std_temp < 5:     
	stability = "보통"          # 보통 수준의 변동 
else: 
    	stability = "불안정"        # 운영 문제 가능성
```

## 2-4) 변동 패턴 분석
```python
if temp_range < 5:     
	range_category = "일정"     # 매우 안정적 
elif temp_range < 15:     
	range_category = "변동"     # 정상적인 변동 
else:     
	range_category = "급변"     # 급격한 변화 발생
```

## 2-4) 최종 라벨: 의미 있는 조합
- 이 세 가지 차원을 조합하여 "정상_안정_일정", "고온_불안정_급변" 같은 직관적이고 실용적인 라벨을 생성했습니다.
```json
{
	"batch_id": 1,   
	"value_label": "정상_안정_일정",   
	"trend": "평형",   
	"stability": "안정",   
	"alert_level": "정상",   
	"statistics": 
	{     
		"mean": 55.2,     
		"std": 2.1,     
		"min": 51.2,     
		"max": 59.8   
	} 
}
```

## 3. 이상 감지 시스템: 데이터가 말하는 위험 신호 
### 다층 경고 시스템
- 리뉴얼된 데이터를 바탕으로 4단계 경고 시스템을 구축했습니다.

### 정상 (Normal)
- 조건: 평균 온도 65°C 이하, 최고 온도 70°C 이하
- 의미: 최적 운영 상태
- 조치: 정기 모니터링 지속
### 관찰 (Watch)
- 조건: 평균 온도 65-75°C, 최고 온도 70-80°C
- 의미: 주의 깊게 관찰 필요
- 조치: 모니터링 주기 단축, 냉각 시스템 점검 준비
### 주의 (Caution)
- 조건: 평균 온도 75-85°C, 최고 온도 80-90°C
- 의미: 잠재적 문제 발생 가능성
- 조치: 냉각 시스템 점검, 부하 조정 고려
### 위험 (Critical)
- 조건: 평균 온도 85°C 초과 또는 최고 온도 90°C 초과
- 의미: 즉시 조치 필요
- 조치: 운영 중단, 긴급 점검 실시
### 실시간 이상 감지의 힘
- 이제 시스템은 단순히 온도를 표시하는 것이 아니라, 상황을 해석하고 판단할 수 있게 되었습니다.
```python
# 실제 이상 감지 예시 
if batch['alert_level'] == '위험':     
	send_alert(f"""
   		긴급 알림: 워터펌프 과열 감지
    		- 배치 ID: {batch['batch_id']}
    		- 평균 온도: {batch['statistics']['mean']:.1f}°C
    		- 특성: {batch['value_label']}
    		- 즉시 조치 필요!
    		""")
```  

## 4. AI 챗봇: 데이터와 대화하는 새로운 방식
### 두 가지 AI 솔루션
- 리뉴얼된 데이터의 진정한 가치는 AI 챗봇 시스템에서 빛을 발했습니다. 우리는 두 가지 접근 방식을 제공했습니다:

4-1) 규칙 기반 전문가 시스템
- 장점: 빠른 응답, 일관된 답변, 도메인 특화
- 활용: 표준화된 분석, 정형화된 리포트
4-2) LLM 기반 지능형 시스템
- 지원 모델: OpenAI GPT-3.5-turbo, Local Ollama
- 장점: 자연어 이해, 복잡한 질문 처리, 맞춤형 분석
- 활용: 창의적 분석, 복합적 인사이트 도출
### 실제 대화 예시
- 사용자: "어제부터 온도가 계속 올라가고 있는데, 언제쯤 정비해야 할까요?"

- AI 응답:
```script 

** 데이터 분석 결과, 배치 15-17에서 평균 온도가 78°C로 
상승 트렌드를 보이고 있습니다. 현재 추세로는 2-3일 내에 
85°C 위험 임계값에 도달할 것으로 예상됩니다.
 🔧 권장 조치:
1. 즉시: 냉각수 유량 점검
2. 24시간 내: 필터 청소 및 교체
3. 48시간 내: 베어링 윤활 상태 확인
4. 주말: 전면 정비 스케줄링

80°C 초과 시 즉시 가동 중단하여 안전을 확보하세요.
```
```
📁 시스템 아키텍처
├── 🔧 water_pump_analyzer.py       # 핵심 분석 엔진
├── 📊 streamlit_dashboard.py       # 시각화 대시보드
├── 🤖 chatbot_implementation.py    # 기본 AI 챗봇
├── 🧠 chatbot_implementation_openai.py # LLM 기반 챗봇
├── 🎲 generate_sample_csv.py       # 테스트 데이터 생성
├── 🚀 run.py                      # 통합 실행 관리
└── 📁 water_pump_data/            # 자동 데이터 관리
```
![image](https://github.com/user-attachments/assets/8578fb48-192d-4144-978e-3cfc74409afa)
